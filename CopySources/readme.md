# CopySources

普段、ロジックの大部分をDLL化してからUnityに取り込んでいるものの、デバッグ上、時々ソースコードをUnity側に全コピーして実行したい場合がある。

## 参考: CopyDllsAfterBuildのフロー

CopyDllsAfterBuild では、csproj の「ビルド後イベント (Post-Build event command line)」で、ビルド結果のDLL一式をUnity配下にコピーする。

DLL化する意義は、

- あまりにソースコードが多いとUnityのビルドが遅くてつらい
- プロジェクトを分けるという概念がUnityにないので、規模が大きくなった時に依存性管理がつらい
- Unityの外から同じコードを使いたいときに困る
  - データ編集ツールとか、サーバー側とのコード共有とか

DLL化した場合の問題

- スタックトレースを追いづらい
  - 一応、.mdb ファイルを生成しておけば、例外発生個所のスタックトレースは何とか追える
    - ブレイク ポイント仕掛けたり、ステップ実行したりも可能
  - それでも、Profiler とか、Android 実機実行時のトレースでは追えなくなる

## このCopySourcesのフロー

DLL化した場合の問題を避けるため、必要に応じて、ソースコードを全コピーして使う想定のプログラムも書くことにした。
使い分けはした方がよくて、Profilerや実機デバッグでスタックトレースをきっちり追いたい場合だけ使う想定。

- 普段: CopyDllsAfterBuild を使ってDLL化済みのコードをUnityに取り込む
- Profilerや実機デバッグでスタックトレースがほしくなったとき: CopySources を使ってソースコードをUnityに取り込む

## 注意

CopySourcesを使って全コピーしたしまった後に、元に戻す(コピーしたソースコードを消して、DLLを復元する)操作はできない。

なので、CopySourcesを実行する前にコミットを忘れずに。元に戻したい場合は「変更を破棄」もしくはリセットで。

あと、Unity側、Library, temp, obj 辺りを消さないと落ちる。
